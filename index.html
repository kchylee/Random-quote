<!DOCTYPE HTML>
<html>
<meta charset="utf-8">
<head>
    <title>Random Quote Generator</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="./public/styles.css">
    <link href="https://fonts.googleapis.com/css?family=Bungee" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
        $(document).ready(() => {
            $("#getQuote").click(() => {
                let firstName;
                let req = new XMLHttpRequest(),
                    method = "GET",
                    url = "https://quotesondesign.com/wp-json/posts?filter[orderby]=rand&filter[posts_per_page]=1";
                req.open(method, url, true);
                req.onreadystatechange = () => {
                    if (req.readyState === XMLHttpRequest.DONE && req.status === 200){
                        let resObj = JSON.parse(req.responseText[0]);
                        $("#quote").html(resObj.content);
                        $("#person").html(resObj.title);
                        $("#row").css("display", "block");
                        firstName = resObj.title.replace(/(\w+)(\s.+)+/, '$1');                       
                        window.setTimeout(()=>{
                            $("#getPerson").css("display", "block").html(firstName + " who???");
                        }, 2000);
                    }else{
                        $("#quote").html(req.status);
                    }
                };
                req.send()
            })

            $("#getPerson").click(() => {
                let name = document.getElementById("person").innerHTML.replace(/\s/g, "%20");
                window.location.replace("https://en.wikipedia.org/wiki/" + name);
                // let req = new XMLHttpRequest(),
                //     method = "GET",
                //     url = `https://en.wikipedia.org/w/api.php?origin=https://kchylee.github.io/&action=query&prop=pageimages|pageterms&titles=${name}&pithumbsize=300`;
                // req.open(method, url, true);
                // req.onreadystatechange = () => {
                //     if (req.readyState === XMLHttpRequest.DONE && req.status === 200){
                //         let resObj = JSON.parse(req.responseText).query.pages;
                //         let key = Object.keys(resObj)[0];
                //         $("#wikiImage").attr("src", resObj.key.thumbnail.source);
                //         $("#description").html(resObj.key.terms.description[0]);
                //         $("#wiki").css("display", "block");
                //     }else{
                //         $("#description").html(req.status);
                //     }
                // };
                // req.send()  
            })
        })
    </script>
</head>
<body>
    <div class="container">
        <div class="row">
                <h1 class="col-xs-8 col-sm-8 col-md-8 col-lg-8">Someone once said...</h1>
        </div>
        <section>
            <div class="row">
                <button id="getQuote">Said what???</button>
            </div>
            <div class="row" id="row">    
                <div id="quote-with-person" class="col-xs-8 col-sm-6 col-md-6 col-lg-6">
                    <p id="quote"></p>
                    <p id="person"></p>
                </div>
            </div>
            <div class="row">
                <button id="getPerson"></button>
            </div>
            <div id="wiki" class="row">
                <img id="wikiImage">
                <div id="description"></div>
            </div>
        <section>
    </div>
</body>
</html>